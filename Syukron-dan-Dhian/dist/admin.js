(()=>{var b=(()=>{let o='<span class="spinner-border spinner-border-sm my-0 ms-0 me-1 p-0" style="height: 0.8rem; width: 0.8rem;"></span>',f=[["*",'<strong class="text-theme-auto">$1</strong>'],["_",'<em class="text-theme-auto">$1</em>'],["~",'<del class="text-theme-auto">$1</del>'],["```",'<code class="font-monospace text-theme-auto">$1</code>']],p=[{type:"Mobile",regex:/Android.*Mobile|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i},{type:"Tablet",regex:/iPad|Android(?!.*Mobile)|Tablet/i},{type:"Desktop",regex:/Windows NT|Macintosh|Linux/i}],u=[{name:"Chrome",regex:/Chrome|CriOS/i},{name:"Safari",regex:/Safari/i},{name:"Edge",regex:/Edg|Edge/i},{name:"Firefox",regex:/Firefox|FxiOS/i},{name:"Opera",regex:/Opera|OPR/i},{name:"Internet Explorer",regex:/MSIE|Trident/i},{name:"Samsung Browser",regex:/SamsungBrowser/i}],g=[{name:"Windows",regex:/Windows NT ([\d.]+)/i},{name:"MacOS",regex:/Mac OS X ([\d_.]+)/i},{name:"Android",regex:/Android ([\d.]+)/i},{name:"iOS",regex:/OS ([\d_]+) like Mac OS X/i},{name:"Linux",regex:/Linux/i},{name:"Ubuntu",regex:/Ubuntu/i},{name:"Chrome OS",regex:/CrOS/i}],c=n=>String(n).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),a=n=>{let l=h=>{window.alert(`${h} ${n}`)};return{success:()=>l("\u{1F7E9}"),error:()=>l("\u{1F7E5}"),warning:()=>l("\u{1F7E8}"),info:()=>l("\u{1F7E6}"),custom:h=>l(h)}},w=n=>window.confirm(`\u{1F7E6} ${n}`),y=(n,l)=>(n.replaceChildren(document.createRange().createContextualFragment(l)),n),T=(n,l,h=.05)=>new Promise(E=>{let k=parseFloat(n.style.opacity),I=l?1:0,O=()=>{if(k+=l?h:-h,k=Math.max(0,Math.min(1,k)),n.style.opacity=k.toFixed(2),!l){let U=parseFloat(n.dataset.y||0);U-=1,n.dataset.y=U,n.style.transform=`translateY(${U}px)`}l&&k>=I||!l&&k<=I?(n.style.opacity=I.toString(),E(n)):requestAnimationFrame(O)};requestAnimationFrame(O)}),s=(n,l=0)=>{let h=null;h=setTimeout(()=>{n(),clearTimeout(h),h=null},l)};return{loader:o,ask:w,copy:async(n,l=null,h=1500)=>{let E=n.getAttribute("data-copy");if(!E||E.length===0){a("Nothing to copy").warning();return}n.disabled=!0;try{await navigator.clipboard.writeText(E)}catch(I){console.error("Clipboard error:",I),n.disabled=!1,a("Failed to copy").error();return}let k=n.innerHTML;y(n,l||'<p class="fw-bold m-0"><i class="fa-solid fa-check"></i> Success</p>'),s(()=>{n.disabled=!1,n.innerHTML=k},h)},notify:a,timeOut:s,debounce:(n,l=100)=>{let h=null;return(...E)=>{clearTimeout(h),h=setTimeout(()=>n(...E),l)}},escapeHtml:c,base64Encode:n=>{let h=new TextEncoder().encode(n);return window.btoa(String.fromCharCode(...h))},base64Decode:n=>{let l=new TextDecoder,h=Uint8Array.from(window.atob(n),E=>E.charCodeAt(0));return l.decode(h)},disableButton:(n,l="Loading",h=!1)=>{n.disabled=!0;let E=n.innerHTML;return y(n,h?l:o+l),{restore:(k=!1)=>{n.innerHTML=E,n.disabled=k}}},disableCheckbox:n=>{n.disabled=!0;let l=document.querySelector(`label[for="${n.id}"]`),h=l.innerHTML;return y(l,o+h),{restore:()=>{l.innerHTML=h,n.disabled=!1}}},safeInnerHTML:y,parseUserAgent:n=>{if(!n||typeof n!="string")return"Unknown";let l=p.find(O=>O.regex.test(n))?.type??"Unknown",h=u.find(O=>O.regex.test(n))?.name??"Unknown",E=g.find(O=>O.regex.test(n)),k=E?E.name:"Unknown",I=E?n.match(E.regex)?.[1]?.replace(/_/g,".")??null:null;return`${h} ${l} ${I?`${k} ${I}`:k}`},changeOpacity:T,getGMTOffset:n=>{let l=new Date,h=new Intl.DateTimeFormat("en-US",{timeZone:n,hourCycle:"h23",hour:"numeric"}),E=(parseInt(h.format(l))-l.getUTCHours()+24)%24;return E>12&&(E-=24),`GMT${E>=0?"+":""}${E}`},convertMarkdownToHTML:n=>(f.forEach(([l,h])=>{n=n.replace(new RegExp(`\\${l}(\\S(?:[\\s\\S]*?\\S)?)\\${l}`,"g"),h)}),n)}})();var H={tab:p=>window.bootstrap.Tab.getOrCreateInstance(document.getElementById(p)),modal:p=>window.bootstrap.Modal.getOrCreateInstance(document.getElementById(p))};var R=(()=>{let o=({uuid:s,own:d,name:v,presence:B,comment:e,created_at:t,is_admin:r,is_parent:m,gif_url:i,ip:x,user_agent:n,comments:l,like_count:h})=>({uuid:s,own:d,name:v,presence:B,comment:e,created_at:t,is_admin:r??!1,is_parent:m,gif_url:i,ip:x,user_agent:n,comments:l?.map(o)??[],like_count:h??0}),f=s=>s.map(o);return{uuidResponse:({uuid:s})=>({uuid:s}),tokenResponse:({token:s})=>({token:s}),statusResponse:({status:s})=>({status:s}),getCommentResponse:o,getCommentsResponse:f,getCommentsResponseV2:s=>({count:s.count,lists:f(s.lists)}),commentShowMore:(s,d=!1)=>({uuid:s,show:d}),postCommentRequest:(s,d,v,B,e)=>({id:s,name:d,presence:v,comment:B,gif_id:e}),postSessionRequest:(s,d)=>({email:s,password:d}),updateCommentRequest:(s,d,v)=>({presence:s,comment:d,gif_id:v})}})();var C=o=>{let f=(a=null)=>{let w=JSON.parse(localStorage.getItem(o));return a?w[String(a)]:w},p=(a,w)=>{let y=f();y[String(a)]=w,localStorage.setItem(o,JSON.stringify(y))},u=a=>Object.keys(f()).includes(String(a)),g=a=>{if(!u(a))return;let w=f();delete w[String(a)],localStorage.setItem(o,JSON.stringify(w))},c=()=>localStorage.setItem(o,"{}");return localStorage.getItem(o)||c(),{set:p,get:f,has:u,clear:c,unset:g}};var _="GET",F="PUT",z="POST",A="PATCH";var N="AbortError",Y="TypeError",q={Accept:"application/json","Content-Type":"application/json"},V="request",G=(()=>{let o=null;return{getInstance:()=>(o||(o=window.caches.open(V)),o),purge:()=>{o=null}}})(),j=async()=>{window.isSecureContext&&(G.purge(),await window.caches.delete(V))},Z=o=>({set:(g,c,a,w)=>c.clone().arrayBuffer().then(y=>{if(!c.ok||!window.isSecureContext)return c;let T=new Date,s=new Headers(c.headers);if(s.has("Date")||s.set("Date",T.toUTCString()),a||!s.has("Cache-Control")){if(!a&&s.has("Expires")){let d=new Date(s.get("Expires"));w=Math.max(0,d.getTime()-T.getTime())}s.set("Cache-Control",`public, max-age=${Math.floor(w/1e3)}`)}return s.has("Content-Length")||s.set("Content-Length",String(y.byteLength)),o.put(g,new Response(y,{headers:s})).then(()=>c)}),has:g=>o.match(g).then(c=>{if(!c)return null;let a=c.headers.get("Cache-Control").match(/max-age=(\d+)/)[1],w=Date.parse(c.headers.get("Date"))+parseInt(a)*1e3;return Date.now()>w?null:c}),del:g=>o.delete(g)}),L=(o,f)=>{let p=new AbortController,u={signal:p.signal,credential:"include",headers:new Headers(q),method:String(o).toUpperCase()};window.addEventListener("offline",()=>p.abort(),{once:!0}),window.addEventListener("popstate",()=>p.abort(),{once:!0});let g=0,c=0,a=0,w=0,y=!1,T=null,s=null,d=null,v=e=>{let t=()=>{let m=()=>window.fetch(e,u).then(async i=>{if(!i.ok||!d)return i;let x=parseInt(i.headers.get("Content-Length")??0);if(x===0)return i;let n=[],l=0,h=i.body.getReader();for(;;){let{done:k,value:I}=await h.read();if(k)break;n.push(I),l+=I.length,await d(l,x,window.structuredClone?window.structuredClone(n):n)}let E=i.headers.get("Content-Type")??"application/octet-stream";return new Response(new Blob(n,{type:E}),{status:i.status,statusText:i.statusText,headers:new Headers(i.headers)})});return g===0||!window.isSecureContext?m():u.method!==_?(console.warn("Only method GET can be cached"),m()):G.getInstance().then(Z).then(i=>i.has(e).then(x=>x?Promise.resolve(x):i.del(e).then(m).then(n=>i.set(e,n,y,g))))};if(c===0&&a===0)return t();let r=async()=>{try{return await t()}catch(m){if(m.name===N)throw m;if(a*=2,w++,w>c)throw new Error(`Max retries reached: ${m}`);return console.warn(`Retrying fetch (${w}/${c}): ${e.toString()}`),await new Promise(i=>window.setTimeout(i,a)),r()}};return r()},B=e=>{if(e.status!==200)return e;let t=document.querySelector("a[download]");t&&document.body.removeChild(t);let r=e.headers.get("Content-Disposition")?.match(/filename="(.+)"/)?.[1];return e.clone().blob().then(m=>{let i=document.createElement("a"),x=window.URL.createObjectURL(m);return i.href=x,i.download=r||`${s}.${T||(m.type.split("/")?.[1]??"bin")}`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(x),e})};return{send(e=null){return s&&Object.keys(q).forEach(t=>u.headers.delete(t)),v(new URL(f,document.body.getAttribute("data-url"))).then(t=>s&&t.ok?{code:t.status,data:B(t),error:null}:t.json().then(r=>{if(r.error){let m=r.error.at(0),i=t.status>=500;throw new Error(i?`ID: ${r.id}
\u{1F7E5} ${m}`:`\u{1F7E8} ${m}`)}return e&&(r.data=e(r.data)),Object.assign(r,{code:t.status})})).catch(t=>{if(t.name===N)return console.warn("Fetch aborted:",t),t;throw t.name===Y&&(t=new Error("\u{1F7E5} Network error or rate limit exceeded")),alert(t.message??String(t)),t})},withCache(e=1e3*60*60*6){return g=e,this},withForceCache(){return y=!0,this},withRetry(e=3,t=1e3){return c=e,a=t,this},withCancel(e){return e==null?this:((async()=>(await e,p.abort()))(),this)},withDownload(e,t=null){return s=e,T=t,this},withProgressFunc(e=null){return d=e,this},default(e=null){return u.headers=new Headers(e??{}),v(f).then(t=>s?B(t):t)},token(e){return e.split(".").length===3?(u.headers.append("Authorization","Bearer "+e),this):(u.headers.append("x-access-key",e),this)},body(e){if(u.method===_)throw new Error("GET method does not support body");return u.body=JSON.stringify(e),this}}};var S=(()=>{let o=null,f=()=>o.get("token"),p=T=>o.set("token",T),u=T=>L(z,"/api/session").body(T).send(R.tokenResponse).then(s=>(s.code===200&&p(s.data.token),s.code===200)),g=()=>o.unset("token"),c=()=>String(f()??".").split(".").length===3;return{init:()=>{o=C("session")},guest:T=>L(_,"/api/v2/config").withCache(1e3*60*30).withForceCache().token(T).send().then(s=>{if(s.code!==200)throw new Error("failed to get config.");let d=C("config");for(let[v,B]of Object.entries(s.data))d.set(v,B);return p(T),s}),login:u,logout:g,decode:()=>{if(!c())return null;try{return JSON.parse(b.base64Decode(f().split(".")[1]))}catch{return null}},isAdmin:c,setToken:p,getToken:f}})();var M=(()=>{let o=null,f=a=>{let w=b.disableButton(a),y=document.getElementById("loginEmail"),T=document.getElementById("loginPassword");y.disabled=!0,T.disabled=!0,S.login(R.postSessionRequest(y.value,T.value)).then(s=>{s&&(y.value=null,T.value=null,H.modal("mainModal").hide())}).finally(()=>{w.restore(),y.disabled=!1,T.disabled=!1})},p=async()=>{await j(),o.clear(),S.logout(),H.modal("mainModal").show()};return{init:()=>{o=C("user")},login:f,clearSession:p,getDetailUser:()=>L(_,"/api/user").token(S.getToken()).send().then(a=>{if(a.code!==200)throw new Error("failed to get user.");return Object.entries(a.data).forEach(([w,y])=>o.set(w,y)),a}).catch(a=>(p(),a)),getUserStorage:()=>o}})();var J=(()=>{let o=(u,g)=>{document.querySelectorAll(".navbar button").forEach(c=>{c.classList.contains("active")&&c.classList.remove("active")}),H.tab(g).show(),u.classList.add("active")};return{buttonNavHome:u=>{o(u,"button-home")},buttonNavSetting:u=>{o(u,"button-setting")}}})();var D=(()=>{let o={"#000000":"#ffffff","#ffffff":"#000000","#212529":"#f8f9fa","#f8f9fa":"#212529"},f=["#ffffff","#f8f9fa"],p=["#000000","#212529"],u=!1,g=null,c=null,a=()=>g.set("active","light"),w=()=>g.set("active","dark"),y=r=>{let m=c.getAttribute("content");c.setAttribute("content",r.some(i=>i===m)?o[m]:m)},T=()=>{a(),document.documentElement.setAttribute("data-bs-theme","light"),y(p)},s=()=>{w(),document.documentElement.setAttribute("data-bs-theme","dark"),y(f)},d=(r=null,m=null)=>{let i=g.get("active")==="dark";return r&&m?i?r:m:i};return{init:()=>{switch(g=C("theme"),c=document.querySelector('meta[name="theme-color"]'),g.has("active")||(window.matchMedia("(prefers-color-scheme: dark)").matches?w():a()),document.documentElement.getAttribute("data-bs-theme")){case"dark":w();break;case"light":a();break;default:u=!0}d()?s():T()},spyTop:()=>{let r=i=>i.filter(x=>x.isIntersecting).forEach(x=>{let n=x.target.classList.contains("bg-white-black")?d(p[0],f[0]):d(p[1],f[1]);c.setAttribute("content",n)}),m=new IntersectionObserver(r,{rootMargin:"0% 0% -95% 0%"});document.querySelectorAll("section").forEach(i=>m.observe(i))},change:()=>d()?T():s(),isDarkMode:d,isAutoMode:()=>u}})();var $=(()=>{let o={id:"ID",en:"US",fr:"FR",de:"DE",es:"ES",zh:"CN",ja:"JP",ko:"KR",ar:"SA",ru:"RU",it:"IT",nl:"NL",pt:"PT",tr:"TR",th:"TH",vi:"VN",ms:"MY",hi:"IN"},f=null,p=null,u=null,g=null;return{on(c,a){return g.set(c,a),this},get(){let c=g.get(u);return g.clear(),c},getCountry(){return f},getLocale(){return p},getLanguage(){return u},setDefault(c){let a=!0;o[c]||(a=!1,console.warn("Language not found, please add manually in countryMapping")),f=a?o[c]:"US",u=a?c:"en",p=`${u}_${f}`},init(){g=new Map,this.setDefault(navigator.language.split("-").shift())}}})();var K=(()=>{let o=null,f=!0,p=["input[data-offline-disabled]","button[data-offline-disabled]","select[data-offline-disabled]","textarea[data-offline-disabled]"],u=()=>f,g=()=>{let d=o.firstElementChild.firstElementChild;d.classList.remove("bg-success"),d.classList.add("bg-danger"),d.firstElementChild.innerHTML='<i class="fa-solid fa-ban me-2"></i>Koneksi tidak tersedia'},c=()=>{let d=o.firstElementChild.firstElementChild;d.classList.remove("bg-danger"),d.classList.add("bg-success"),d.firstElementChild.innerHTML='<i class="fa-solid fa-cloud me-2"></i>Koneksi tersedia kembali'},a=async()=>{f&&(await b.changeOpacity(o,!1),g())},w=()=>{document.querySelectorAll(p.join(", ")).forEach(d=>{d.dispatchEvent(new Event(u()?"online":"offline")),d.setAttribute("data-offline-disabled",u()?"false":"true"),d.tagName==="BUTTON"?u()?d.classList.remove("disabled"):d.classList.add("disabled"):u()?d.removeAttribute("disabled"):d.setAttribute("disabled","true")})},y=()=>{f=!1,g(),b.changeOpacity(o,!0),w()},T=()=>{f=!0,c(),b.timeOut(a,3e3),w()};return{init:()=>{window.addEventListener("online",T),window.addEventListener("offline",y),o=document.createElement("div"),o.classList.add("fixed-top","pe-none"),o.style.cssText="opacity: 0; z-index: 1057;",o.innerHTML=`
        <div class="d-flex justify-content-center mx-auto">
            <div class="d-flex justify-content-center align-items-center rounded-pill my-2 bg-danger shadow">
                <small class="text-center py-1 px-2 mx-1 mt-1 mb-0 text-white" style="font-size: 0.8rem;"></small>
            </div>
        </div>`,document.body.insertBefore(o,document.body.lastChild)},isOnline:u}})();var W=(()=>{let o=()=>M.getDetailUser().then(e=>{b.safeInnerHTML(document.getElementById("dashboard-name"),`${b.escapeHtml(e.data.name)}<i class="fa-solid fa-hands text-warning ms-2"></i>`),document.getElementById("dashboard-email").textContent=e.data.email,document.getElementById("dashboard-accesskey").value=e.data.access_key,document.getElementById("button-copy-accesskey").setAttribute("data-copy",e.data.access_key),document.getElementById("form-name").value=b.escapeHtml(e.data.name),document.getElementById("form-timezone").value=e.data.tz,document.getElementById("filterBadWord").checked=!!e.data.is_filter,document.getElementById("confettiAnimation").checked=!!e.data.is_confetti_animation,document.getElementById("replyComment").checked=!!e.data.can_reply,document.getElementById("editComment").checked=!!e.data.can_edit,document.getElementById("deleteComment").checked=!!e.data.can_delete,document.getElementById("dashboard-tenorkey").value=e.data.tenor_key,C("config").set("tenor_key",e.data.tenor_key),document.dispatchEvent(new Event("undangan.session")),L(_,"/api/stats").token(S.getToken()).withCache(3e4).withForceCache().send().then(t=>{document.getElementById("count-comment").textContent=String(t.data.comments).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-like").textContent=String(t.data.likes).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-present").textContent=String(t.data.present).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-absent").textContent=String(t.data.absent).replace(/\B(?=(\d{3})+(?!\d))/g,".")}),comment.show()}),f=(e,t)=>{let r=b.disableCheckbox(e);L(A,"/api/user").token(S.getToken()).body({[t]:e.checked}).send().finally(()=>r.restore())},p=e=>{let t=b.disableButton(e),r=document.getElementById("dashboard-tenorkey");r.disabled=!0,L(A,"/api/user").token(S.getToken()).body({tenor_key:r.value.length?r.value:null}).send().then(()=>b.notify(`success ${r.value.length?"add":"remove"} tenor key`).success()).finally(()=>{r.disabled=!1,t.restore()})},u=e=>{if(!b.ask("Are you sure?"))return;let t=b.disableButton(e);L(F,"/api/key").token(S.getToken()).send(R.statusResponse).then(r=>{r.data.status&&o()}).finally(()=>t.restore())},g=e=>{let t=document.getElementById("old_password"),r=document.getElementById("new_password");if(t.value.length===0||r.value.length===0){b.notify("Password cannot be empty").warning();return}t.disabled=!0,r.disabled=!0;let m=b.disableButton(e);L(A,"/api/user").token(S.getToken()).body({old_password:t.value,new_password:r.value}).send(R.statusResponse).then(i=>{i.data.status&&(t.value=null,r.value=null,b.notify("Success change password").success())}).finally(()=>{m.restore(!0),t.disabled=!1,r.disabled=!1})},c=e=>{let t=document.getElementById("form-name");if(t.value.length===0){b.notify("Name cannot be empty").warning();return}t.disabled=!0;let r=b.disableButton(e);L(A,"/api/user").token(S.getToken()).body({name:t.value}).send(R.statusResponse).then(m=>{m.data.status&&(b.safeInnerHTML(document.getElementById("dashboard-name"),`${b.escapeHtml(t.value)}<i class="fa-solid fa-hands text-warning ms-2"></i>`),b.notify("Success change name").success())}).finally(()=>{t.disabled=!1,r.restore(!0)})},a=e=>{let t=b.disableButton(e);L(_,"/api/download").token(S.getToken()).withDownload("download","csv").send().finally(()=>t.restore())},w=()=>{let e=document.getElementById("button-change-name");e.disabled&&(e.disabled=!1)},y=()=>{let e=document.getElementById("button-change-password"),t=document.getElementById("old_password");e.disabled&&t.value.length!==0&&(e.disabled=!1)},T=(e,t=null)=>{let r=Intl.supportedValuesOf("timeZone"),m=document.getElementById("dropdown-tz-list");e.value&&e.value.trim().length>0&&(r=r.filter(i=>i.toLowerCase().includes(e.value.trim().toLowerCase()))),t===null&&document.addEventListener("click",i=>{if(!e.contains(i.currentTarget)&&!m.contains(i.currentTarget)){if(e.value.trim().length<=0){e.setCustomValidity("Timezone cannot be empty."),e.reportValidity();return}e.setCustomValidity(""),m.classList.add("d-none")}},{once:!0,capture:!0}),m.replaceChildren(),m.classList.remove("d-none"),r.slice(0,20).forEach(i=>{let x=document.createElement("button");x.type="button",x.className="list-group-item list-group-item-action py-1 small",x.textContent=`${i} (${b.getGMTOffset(i)})`,x.onclick=()=>{e.value=i,m.classList.add("d-none"),document.getElementById("button-timezone").disabled=!1},m.appendChild(x)})},s=e=>{let t=document.getElementById("form-timezone");if(t.value.length===0){b.notify("Time zone cannot be empty").warning();return}if(!Intl.supportedValuesOf("timeZone").includes(t.value)){b.notify("Timezone not supported").warning();return}t.disabled=!0;let r=b.disableButton(e);L(A,"/api/user").token(S.getToken()).body({tz:t.value}).send(R.statusResponse).then(m=>{m.data.status&&b.notify("Success change tz").success()}).finally(()=>{t.disabled=!1,r.restore(!0)})},d=()=>{b.ask("Are you sure?")&&M.clearSession()},v=()=>{$.init(),$.setDefault("en"),K.init(),D.spyTop(),document.addEventListener("hidden.bs.modal",o);try{let e=window.location.hash.slice(1);e.length>0&&(S.setToken(e),window.history.replaceState({},document.title,window.location.pathname));let t=S.decode()?.exp;if(!t||t<Date.now()/1e3)throw new Error("Invalid token");o()}catch{M.clearSession()}};return{init:()=>(M.init(),D.init(),S.init(),S.isAdmin()||(C("owns").clear(),C("likes").clear(),C("config").clear(),C("comment").clear(),C("session").clear(),C("information").clear()),document.addEventListener("DOMContentLoaded",v),{util:b,theme:D,comment,admin:{auth:M,navbar:J,logout:d,tenor:p,download:a,regenerate:u,changeName:c,changePassword:g,changeCheckboxValue:f,enableButtonName:w,enableButtonPassword:y,openLists:T,changeTz:s}})}})();(o=>{o.undangan=W.init()})(window);})();
