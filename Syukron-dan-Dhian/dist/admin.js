(()=>{var b=(()=>{let o='<span class="spinner-border spinner-border-sm my-0 ms-0 me-1 p-0" style="height: 0.8rem; width: 0.8rem;"></span>',f=[["*",'<strong class="text-theme-auto">$1</strong>'],["_",'<em class="text-theme-auto">$1</em>'],["~",'<del class="text-theme-auto">$1</del>'],["```",'<code class="font-monospace text-theme-auto">$1</code>']],h=[{type:"Mobile",regex:/Android.*Mobile|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i},{type:"Tablet",regex:/iPad|Android(?!.*Mobile)|Tablet/i},{type:"Desktop",regex:/Windows NT|Macintosh|Linux/i}],u=[{name:"Chrome",regex:/Chrome|CriOS/i},{name:"Safari",regex:/Safari/i},{name:"Edge",regex:/Edg|Edge/i},{name:"Firefox",regex:/Firefox|FxiOS/i},{name:"Opera",regex:/Opera|OPR/i},{name:"Internet Explorer",regex:/MSIE|Trident/i},{name:"Samsung Browser",regex:/SamsungBrowser/i}],g=[{name:"Windows",regex:/Windows NT ([\d.]+)/i},{name:"MacOS",regex:/Mac OS X ([\d_.]+)/i},{name:"Android",regex:/Android ([\d.]+)/i},{name:"iOS",regex:/OS ([\d_]+) like Mac OS X/i},{name:"Linux",regex:/Linux/i},{name:"Ubuntu",regex:/Ubuntu/i},{name:"Chrome OS",regex:/CrOS/i}],c=n=>String(n).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),a=n=>{let d=w=>{window.alert(`${w} ${n}`)};return{success:()=>d("\u{1F7E9}"),error:()=>d("\u{1F7E5}"),warning:()=>d("\u{1F7E8}"),info:()=>d("\u{1F7E6}"),custom:w=>d(w)}},p=n=>window.confirm(`\u{1F7E6} ${n}`),y=(n,d)=>(n.replaceChildren(document.createRange().createContextualFragment(d)),n),T=(n,d)=>new Promise(w=>{let E=null,B=600,I=O=>{E||(E=O);let D=Math.min((O-E)/B,1),q=d?D**(1/3):1-(1-D)**3,X=d?q:1-q;if(n.style.opacity=X.toFixed(2),!d){let $=parseFloat(n.dataset.y||0);$-=2*(1-D),n.dataset.y=$,n.style.transform=`translateY(${$}px)`}D<1?requestAnimationFrame(I):(n.style.opacity=d?"1":"0",w(n))};requestAnimationFrame(I)}),s=(n,d=0)=>{let w=null;w=setTimeout(()=>{n(),clearTimeout(w),w=null},d)};return{loader:o,ask:p,copy:async(n,d=null,w=1500)=>{let E=n.getAttribute("data-copy");if(!E||E.length===0){a("Nothing to copy").warning();return}n.disabled=!0;try{await navigator.clipboard.writeText(E)}catch(I){console.error("Clipboard error:",I),n.disabled=!1,a("Failed to copy").error();return}let B=n.innerHTML;y(n,d||'<p class="fw-bold m-0"><i class="fa-solid fa-check"></i> Success</p>'),s(()=>{n.disabled=!1,n.innerHTML=B},w)},notify:a,timeOut:s,debounce:(n,d=100)=>{let w=null;return(...E)=>{clearTimeout(w),w=setTimeout(()=>n(...E),d)}},escapeHtml:c,base64Encode:n=>{let w=new TextEncoder().encode(n);return window.btoa(String.fromCharCode(...w))},base64Decode:n=>{let d=new TextDecoder,w=Uint8Array.from(window.atob(n),E=>E.charCodeAt(0));return d.decode(w)},disableButton:(n,d="Loading",w=!1)=>{n.disabled=!0;let E=n.innerHTML;return y(n,w?d:o+d),{restore:(B=!1)=>{n.innerHTML=E,n.disabled=B}}},disableCheckbox:n=>{n.disabled=!0;let d=document.querySelector(`label[for="${n.id}"]`),w=d.innerHTML;return y(d,o+w),{restore:()=>{d.innerHTML=w,n.disabled=!1}}},safeInnerHTML:y,parseUserAgent:n=>{if(!n||typeof n!="string")return"Unknown";let d=h.find(O=>O.regex.test(n))?.type??"Unknown",w=u.find(O=>O.regex.test(n))?.name??"Unknown",E=g.find(O=>O.regex.test(n)),B=E?E.name:"Unknown",I=E?n.match(E.regex)?.[1]?.replace(/_/g,".")??null:null;return`${w} ${d} ${I?`${B} ${I}`:B}`},changeOpacity:T,getGMTOffset:n=>{let d=new Date,w=new Intl.DateTimeFormat("en-US",{timeZone:n,hourCycle:"h23",hour:"numeric"}),E=(parseInt(w.format(d))-d.getUTCHours()+24)%24;return E>12&&(E-=24),`GMT${E>=0?"+":""}${E}`},convertMarkdownToHTML:n=>(f.forEach(([d,w])=>{n=n.replace(new RegExp(`\\${d}(\\S(?:[\\s\\S]*?\\S)?)\\${d}`,"g"),w)}),n)}})();var H={tab:h=>window.bootstrap.Tab.getOrCreateInstance(document.getElementById(h)),modal:h=>window.bootstrap.Modal.getOrCreateInstance(document.getElementById(h))};var R=(()=>{let o=({uuid:s,own:l,name:C,presence:L,comment:e,created_at:t,is_admin:r,is_parent:m,gif_url:i,ip:x,user_agent:n,comments:d,like_count:w})=>({uuid:s,own:l,name:C,presence:L,comment:e,created_at:t,is_admin:r??!1,is_parent:m,gif_url:i,ip:x,user_agent:n,comments:d?.map(o)??[],like_count:w??0}),f=s=>s.map(o);return{uuidResponse:({uuid:s})=>({uuid:s}),tokenResponse:({token:s})=>({token:s}),statusResponse:({status:s})=>({status:s}),getCommentResponse:o,getCommentsResponse:f,getCommentsResponseV2:s=>({count:s.count,lists:f(s.lists)}),commentShowMore:(s,l=!1)=>({uuid:s,show:l}),postCommentRequest:(s,l,C,L,e)=>({id:s,name:l,presence:C,comment:L,gif_id:e}),postSessionRequest:(s,l)=>({email:s,password:l}),updateCommentRequest:(s,l,C)=>({presence:s,comment:l,gif_id:C})}})();var k=o=>{let f=(a=null)=>{let p=JSON.parse(localStorage.getItem(o));return a?p[String(a)]:p},h=(a,p)=>{let y=f();y[String(a)]=p,localStorage.setItem(o,JSON.stringify(y))},u=a=>Object.keys(f()).includes(String(a)),g=a=>{if(!u(a))return;let p=f();delete p[String(a)],localStorage.setItem(o,JSON.stringify(p))},c=()=>localStorage.setItem(o,"{}");return localStorage.getItem(o)||c(),{set:h,get:f,has:u,clear:c,unset:g}};var _="GET",V="PUT",G="POST",A="PATCH";var F="AbortError",Q="TypeError",z={Accept:"application/json","Content-Type":"application/json"},j="request",J=(()=>{let o=null;return{getInstance:()=>(o||(o=window.caches.open(j)),o),purge:()=>{o=null}}})(),K=async()=>{window.isSecureContext&&(J.purge(),await window.caches.delete(j))},ee=o=>({set:(g,c,a,p)=>c.clone().arrayBuffer().then(y=>{if(!c.ok||!window.isSecureContext)return c;let T=new Date,s=new Headers(c.headers);if(s.has("Date")||s.set("Date",T.toUTCString()),a||!s.has("Cache-Control")){if(!a&&s.has("Expires")){let l=new Date(s.get("Expires"));p=Math.max(0,l.getTime()-T.getTime())}s.set("Cache-Control",`public, max-age=${Math.floor(p/1e3)}`)}return s.has("Content-Length")||s.set("Content-Length",String(y.byteLength)),o.put(g,new Response(y,{headers:s})).then(()=>c)}),has:g=>o.match(g).then(c=>{if(!c)return null;let a=c.headers.get("Cache-Control").match(/max-age=(\d+)/)[1],p=Date.parse(c.headers.get("Date"))+parseInt(a)*1e3;return Date.now()>p?null:c}),del:g=>o.delete(g)}),v=(o,f)=>{let h=new AbortController,u={signal:h.signal,credential:"include",headers:new Headers(z),method:String(o).toUpperCase()};window.addEventListener("offline",()=>h.abort(),{once:!0}),window.addEventListener("popstate",()=>h.abort(),{once:!0});let g=0,c=0,a=0,p=0,y=!1,T=null,s=null,l=null,C=e=>{let t=()=>{let m=()=>window.fetch(e,u).then(async i=>{if(!i.ok||!l)return i;let x=parseInt(i.headers.get("Content-Length")??0);if(x===0)return i;let n=[],d=0,w=i.body.getReader();for(;;){let{done:B,value:I}=await w.read();if(B)break;n.push(I),d+=I.length,await l(d,x,window.structuredClone?window.structuredClone(n):n)}let E=i.headers.get("Content-Type")??"application/octet-stream";return new Response(new Blob(n,{type:E}),{status:i.status,statusText:i.statusText,headers:new Headers(i.headers)})});return g===0||!window.isSecureContext?m():u.method!==_?(console.warn("Only method GET can be cached"),m()):J.getInstance().then(ee).then(i=>i.has(e).then(x=>x?Promise.resolve(x):i.del(e).then(m).then(n=>i.set(e,n,y,g))))};if(c===0&&a===0)return t();let r=async()=>{try{return await t()}catch(m){if(m.name===F)throw m;if(a*=2,p++,p>c)throw new Error(`Max retries reached: ${m}`);return console.warn(`Retrying fetch (${p}/${c}): ${e.toString()}`),await new Promise(i=>window.setTimeout(i,a)),r()}};return r()},L=e=>{if(e.status!==200)return e;let t=document.querySelector("a[download]");t&&document.body.removeChild(t);let r=e.headers.get("Content-Disposition")?.match(/filename="(.+)"/)?.[1];return e.clone().blob().then(m=>{let i=document.createElement("a"),x=window.URL.createObjectURL(m);return i.href=x,i.download=r||`${s}.${T||(m.type.split("/")?.[1]??"bin")}`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(x),e})};return{send(e=null){return s&&Object.keys(z).forEach(t=>u.headers.delete(t)),C(new URL(f,document.body.getAttribute("data-url"))).then(t=>s&&t.ok?{code:t.status,data:L(t),error:null}:t.json().then(r=>{if(r.error){let m=r.error.at(0),i=t.status>=500;throw new Error(i?`ID: ${r.id}
\u{1F7E5} ${m}`:`\u{1F7E8} ${m}`)}return e&&(r.data=e(r.data)),Object.assign(r,{code:t.status})})).catch(t=>{if(t.name===F)return console.warn("Fetch aborted:",t),t;throw t.name===Q&&(t=new Error("\u{1F7E5} Network error or rate limit exceeded")),alert(t.message??String(t)),t})},withCache(e=1e3*60*60*6){return g=e,this},withForceCache(){return y=!0,this},withRetry(e=3,t=1e3){return c=e,a=t,this},withCancel(e){return e==null?this:((async()=>(await e,h.abort()))(),this)},withDownload(e,t=null){return s=e,T=t,this},withProgressFunc(e=null){return l=e,this},default(e=null){return u.headers=new Headers(e??{}),C(f).then(t=>s?L(t):t)},token(e){return e.split(".").length===3?(u.headers.append("Authorization","Bearer "+e),this):(u.headers.append("x-access-key",e),this)},body(e){if(u.method===_)throw new Error("GET method does not support body");return u.body=JSON.stringify(e),this}}};var S=(()=>{let o=null,f=()=>o.get("token"),h=T=>o.set("token",T),u=T=>v(G,"/api/session").body(T).send(R.tokenResponse).then(s=>(s.code===200&&h(s.data.token),s.code===200)),g=()=>o.unset("token"),c=()=>String(f()??".").split(".").length===3;return{init:()=>{o=k("session")},guest:T=>v(_,"/api/v2/config").withCache(1e3*60*30).withForceCache().token(T).send().then(s=>{if(s.code!==200)throw new Error("failed to get config.");let l=k("config");for(let[C,L]of Object.entries(s.data))l.set(C,L);return h(T),s}),login:u,logout:g,decode:()=>{if(!c())return null;try{return JSON.parse(b.base64Decode(f().split(".")[1]))}catch{return null}},isAdmin:c,setToken:h,getToken:f}})();var M=(()=>{let o=null,f=a=>{let p=b.disableButton(a),y=document.getElementById("loginEmail"),T=document.getElementById("loginPassword");y.disabled=!0,T.disabled=!0,S.login(R.postSessionRequest(y.value,T.value)).then(s=>{s&&(y.value=null,T.value=null,H.modal("mainModal").hide())}).finally(()=>{p.restore(),y.disabled=!1,T.disabled=!1})},h=async()=>{await K(),o.clear(),S.logout(),H.modal("mainModal").show()};return{init:()=>{o=k("user")},login:f,clearSession:h,getDetailUser:()=>v(_,"/api/user").token(S.getToken()).send().then(a=>{if(a.code!==200)throw new Error("failed to get user.");return Object.entries(a.data).forEach(([p,y])=>o.set(p,y)),a}).catch(a=>(h(),a)),getUserStorage:()=>o}})();var W=(()=>{let o=(u,g)=>{document.querySelectorAll(".navbar button").forEach(c=>{c.classList.contains("active")&&c.classList.remove("active")}),H.tab(g).show(),u.classList.add("active")};return{buttonNavHome:u=>{o(u,"button-home")},buttonNavSetting:u=>{o(u,"button-setting")}}})();var U=(()=>{let o={"#000000":"#ffffff","#ffffff":"#000000","#212529":"#f8f9fa","#f8f9fa":"#212529"},f=["#ffffff","#f8f9fa"],h=["#000000","#212529"],u=!1,g=null,c=null,a=()=>g.set("active","light"),p=()=>g.set("active","dark"),y=r=>{let m=c.getAttribute("content");c.setAttribute("content",r.some(i=>i===m)?o[m]:m)},T=()=>{a(),document.documentElement.setAttribute("data-bs-theme","light"),y(h)},s=()=>{p(),document.documentElement.setAttribute("data-bs-theme","dark"),y(f)},l=(r=null,m=null)=>{let i=g.get("active")==="dark";return r&&m?i?r:m:i};return{init:()=>{switch(g=k("theme"),c=document.querySelector('meta[name="theme-color"]'),g.has("active")||(window.matchMedia("(prefers-color-scheme: dark)").matches?p():a()),document.documentElement.getAttribute("data-bs-theme")){case"dark":p();break;case"light":a();break;default:u=!0}l()?s():T()},spyTop:()=>{let r=i=>i.filter(x=>x.isIntersecting).forEach(x=>{let n=x.target.classList.contains("bg-white-black")?l(h[0],f[0]):l(h[1],f[1]);c.setAttribute("content",n)}),m=new IntersectionObserver(r,{rootMargin:"0% 0% -95% 0%"});document.querySelectorAll("section").forEach(i=>m.observe(i))},change:()=>l()?T():s(),isDarkMode:l,isAutoMode:()=>u}})();var N=(()=>{let o={id:"ID",en:"US",fr:"FR",de:"DE",es:"ES",zh:"CN",ja:"JP",ko:"KR",ar:"SA",ru:"RU",it:"IT",nl:"NL",pt:"PT",tr:"TR",th:"TH",vi:"VN",ms:"MY",hi:"IN"},f=null,h=null,u=null,g=null;return{on(c,a){return g.set(c,a),this},get(){let c=g.get(u);return g.clear(),c},getCountry(){return f},getLocale(){return h},getLanguage(){return u},setDefault(c){let a=!0;o[c]||(a=!1,console.warn("Language not found, please add manually in countryMapping")),f=a?o[c]:"US",u=a?c:"en",h=`${u}_${f}`},init(){g=new Map,this.setDefault(navigator.language.split("-").shift())}}})();var Y=(()=>{let o=null,f=!0,h=["input[data-offline-disabled]","button[data-offline-disabled]","select[data-offline-disabled]","textarea[data-offline-disabled]"],u=()=>f,g=()=>{let l=o.firstElementChild.firstElementChild;l.classList.remove("bg-success"),l.classList.add("bg-danger"),l.firstElementChild.innerHTML='<i class="fa-solid fa-ban me-2"></i>Koneksi tidak tersedia'},c=()=>{let l=o.firstElementChild.firstElementChild;l.classList.remove("bg-danger"),l.classList.add("bg-success"),l.firstElementChild.innerHTML='<i class="fa-solid fa-cloud me-2"></i>Koneksi tersedia kembali'},a=async()=>{f&&(await b.changeOpacity(o,!1),g())},p=()=>{document.querySelectorAll(h.join(", ")).forEach(l=>{l.dispatchEvent(new Event(u()?"online":"offline")),l.setAttribute("data-offline-disabled",u()?"false":"true"),l.tagName==="BUTTON"?u()?l.classList.remove("disabled"):l.classList.add("disabled"):u()?l.removeAttribute("disabled"):l.setAttribute("disabled","true")})},y=()=>{f=!1,g(),b.changeOpacity(o,!0),p()},T=()=>{f=!0,c(),b.timeOut(a,3e3),p()};return{init:()=>{window.addEventListener("online",T),window.addEventListener("offline",y),o=document.createElement("div"),o.classList.add("fixed-top","pe-none"),o.style.cssText="opacity: 0; z-index: 1057;",o.innerHTML=`
        <div class="d-flex justify-content-center mx-auto">
            <div class="d-flex justify-content-center align-items-center rounded-pill my-2 bg-danger shadow">
                <small class="text-center py-1 px-2 mx-1 mt-1 mb-0 text-white" style="font-size: 0.8rem;"></small>
            </div>
        </div>`,document.body.insertBefore(o,document.body.lastChild)},isOnline:u}})();var Z=(()=>{let o=()=>M.getDetailUser().then(e=>{b.safeInnerHTML(document.getElementById("dashboard-name"),`${b.escapeHtml(e.data.name)}<i class="fa-solid fa-hands text-warning ms-2"></i>`),document.getElementById("dashboard-email").textContent=e.data.email,document.getElementById("dashboard-accesskey").value=e.data.access_key,document.getElementById("button-copy-accesskey").setAttribute("data-copy",e.data.access_key),document.getElementById("form-name").value=b.escapeHtml(e.data.name),document.getElementById("form-timezone").value=e.data.tz,document.getElementById("filterBadWord").checked=!!e.data.is_filter,document.getElementById("confettiAnimation").checked=!!e.data.is_confetti_animation,document.getElementById("replyComment").checked=!!e.data.can_reply,document.getElementById("editComment").checked=!!e.data.can_edit,document.getElementById("deleteComment").checked=!!e.data.can_delete,document.getElementById("dashboard-tenorkey").value=e.data.tenor_key,k("config").set("tenor_key",e.data.tenor_key),document.dispatchEvent(new Event("undangan.session")),v(_,"/api/stats").token(S.getToken()).withCache(3e4).withForceCache().send().then(t=>{document.getElementById("count-comment").textContent=String(t.data.comments).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-like").textContent=String(t.data.likes).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-present").textContent=String(t.data.present).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-absent").textContent=String(t.data.absent).replace(/\B(?=(\d{3})+(?!\d))/g,".")}),comment.show()}),f=(e,t)=>{let r=b.disableCheckbox(e);v(A,"/api/user").token(S.getToken()).body({[t]:e.checked}).send().finally(()=>r.restore())},h=e=>{let t=b.disableButton(e),r=document.getElementById("dashboard-tenorkey");r.disabled=!0,v(A,"/api/user").token(S.getToken()).body({tenor_key:r.value.length?r.value:null}).send().then(()=>b.notify(`success ${r.value.length?"add":"remove"} tenor key`).success()).finally(()=>{r.disabled=!1,t.restore()})},u=e=>{if(!b.ask("Are you sure?"))return;let t=b.disableButton(e);v(V,"/api/key").token(S.getToken()).send(R.statusResponse).then(r=>{r.data.status&&o()}).finally(()=>t.restore())},g=e=>{let t=document.getElementById("old_password"),r=document.getElementById("new_password");if(t.value.length===0||r.value.length===0){b.notify("Password cannot be empty").warning();return}t.disabled=!0,r.disabled=!0;let m=b.disableButton(e);v(A,"/api/user").token(S.getToken()).body({old_password:t.value,new_password:r.value}).send(R.statusResponse).then(i=>{i.data.status&&(t.value=null,r.value=null,b.notify("Success change password").success())}).finally(()=>{m.restore(!0),t.disabled=!1,r.disabled=!1})},c=e=>{let t=document.getElementById("form-name");if(t.value.length===0){b.notify("Name cannot be empty").warning();return}t.disabled=!0;let r=b.disableButton(e);v(A,"/api/user").token(S.getToken()).body({name:t.value}).send(R.statusResponse).then(m=>{m.data.status&&(b.safeInnerHTML(document.getElementById("dashboard-name"),`${b.escapeHtml(t.value)}<i class="fa-solid fa-hands text-warning ms-2"></i>`),b.notify("Success change name").success())}).finally(()=>{t.disabled=!1,r.restore(!0)})},a=e=>{let t=b.disableButton(e);v(_,"/api/download").token(S.getToken()).withDownload("download","csv").send().finally(()=>t.restore())},p=()=>{let e=document.getElementById("button-change-name");e.disabled&&(e.disabled=!1)},y=()=>{let e=document.getElementById("button-change-password"),t=document.getElementById("old_password");e.disabled&&t.value.length!==0&&(e.disabled=!1)},T=(e,t=null)=>{let r=Intl.supportedValuesOf("timeZone"),m=document.getElementById("dropdown-tz-list");e.value&&e.value.trim().length>0&&(r=r.filter(i=>i.toLowerCase().includes(e.value.trim().toLowerCase()))),t===null&&document.addEventListener("click",i=>{if(!e.contains(i.currentTarget)&&!m.contains(i.currentTarget)){if(e.value.trim().length<=0){e.setCustomValidity("Timezone cannot be empty."),e.reportValidity();return}e.setCustomValidity(""),m.classList.add("d-none")}},{once:!0,capture:!0}),m.replaceChildren(),m.classList.remove("d-none"),r.slice(0,20).forEach(i=>{let x=document.createElement("button");x.type="button",x.className="list-group-item list-group-item-action py-1 small",x.textContent=`${i} (${b.getGMTOffset(i)})`,x.onclick=()=>{e.value=i,m.classList.add("d-none"),document.getElementById("button-timezone").disabled=!1},m.appendChild(x)})},s=e=>{let t=document.getElementById("form-timezone");if(t.value.length===0){b.notify("Time zone cannot be empty").warning();return}if(!Intl.supportedValuesOf("timeZone").includes(t.value)){b.notify("Timezone not supported").warning();return}t.disabled=!0;let r=b.disableButton(e);v(A,"/api/user").token(S.getToken()).body({tz:t.value}).send(R.statusResponse).then(m=>{m.data.status&&b.notify("Success change tz").success()}).finally(()=>{t.disabled=!1,r.restore(!0)})},l=()=>{b.ask("Are you sure?")&&M.clearSession()},C=()=>{N.init(),N.setDefault("en"),Y.init(),U.spyTop(),document.addEventListener("hidden.bs.modal",o);try{let e=window.location.hash.slice(1);e.length>0&&(S.setToken(e),window.history.replaceState({},document.title,window.location.pathname));let t=S.decode()?.exp;if(!t||t<Date.now()/1e3)throw new Error("Invalid token");o()}catch{M.clearSession()}};return{init:()=>(M.init(),U.init(),S.init(),S.isAdmin()||(k("owns").clear(),k("likes").clear(),k("config").clear(),k("comment").clear(),k("session").clear(),k("information").clear()),document.addEventListener("DOMContentLoaded",C),{util:b,theme:U,comment,admin:{auth:M,navbar:W,logout:l,tenor:h,download:a,regenerate:u,changeName:c,changePassword:g,changeCheckboxValue:f,enableButtonName:p,enableButtonPassword:y,openLists:T,changeTz:s}})}})();(o=>{o.undangan=Z.init()})(window);})();
